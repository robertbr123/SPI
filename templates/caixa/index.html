{% extends 'base.html' %}
{% block title %}Caixa - SPI{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
  <h1 class="h4 m-0">Caixa</h1>
  <form method="get" class="d-flex gap-2" style="max-width:480px;">
    <select name="mes" class="form-select">
      <option value="">Mês</option>
      {% for m in months %}
      <option value="{{ m }}" {% if filtro_mes|default_if_none:''|add:'' == m|stringformat:"i" %}selected{% endif %}>{{ m|stringformat:"02d" }}</option>
      {% endfor %}
    </select>
    <input type="number" name="ano" class="form-control" placeholder="Ano" value="{{ filtro_ano }}" min="1900" max="2100">
    <button class="btn btn-primary" type="submit">Filtrar</button>
    <a class="btn btn-outline-secondary" href="/caixa/">Limpar</a>
  </form>
</div>
<div class="row g-3">
  <div class="col-12 col-md-4">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6 text-success">R$ {{ receitas }}</div>
        <div class="text-muted">Receitas</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-4">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6 text-danger">R$ {{ despesas }}</div>
        <div class="text-muted">Despesas</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-4">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6 {% if saldo >= 0 %}text-success{% else %}text-danger{% endif %}">R$ {{ saldo }}</div>
        <div class="text-muted">Saldo</div>
      </div>
    </div>
  </div>
</div>
<div class="row g-3 mt-1">
  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-body">
        <h2 class="h6">Novo Lançamento</h2>
        <form method="post">
          {% csrf_token %}
          <div class="row g-2">
            <div class="col-12 col-sm-4">
              <select name="tipo" class="form-select" required>
                <option value="receita">Receita</option>
                <option value="despesa">Despesa</option>
              </select>
            </div>
            <div class="col-12 col-sm-8">
              <input class="form-control" name="categoria" placeholder="Categoria (ex.: Aluguel, Salário, Mensalidade)" required>
            </div>
            <div class="col-12">
              <input class="form-control" name="descricao" placeholder="Descrição (opcional)">
            </div>
            <div class="col-6">
              <input class="form-control" name="valor" placeholder="Valor" type="number" step="0.01" required>
            </div>
            <div class="col-6">
              <input class="form-control" name="data" type="date" required>
            </div>
          </div>
          <div class="mt-3">
            <button class="btn btn-primary" type="submit">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-6">
    <div class="card">
      <div class="card-body">
        <h2 class="h6">Lançamentos</h2>
        <div class="table-responsive">
          <table class="table align-middle">
            <thead><tr><th>Data</th><th>Tipo</th><th>Categoria</th><th>Valor</th><th>Descrição</th></tr></thead>
            <tbody>
              {% for l in lancamentos %}
              <tr>
                <td>{{ l.data|date:'d/m/Y' }}</td>
                <td><span class="badge bg-{% if l.tipo == 'receita' %}success{% else %}danger{% endif %}">{{ l.get_tipo_display }}</span></td>
                <td>{{ l.categoria }}</td>
                <td>R$ {{ l.valor }}</td>
                <td>{{ l.descricao }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="5" class="text-center text-muted">Nenhum lançamento encontrado.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
