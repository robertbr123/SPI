{% extends 'base.html' %}
{% block title %}Relatórios - SPI{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
  <h1 class="h4 m-0">Relatórios</h1>
  {% if config.logo %}
  <img src="{{ config.logo.url }}" alt="Logo" style="height:48px" class="ms-auto">
  {% endif %}
  <form method="get" class="d-flex gap-2 ms-auto" style="max-width:480px;">
    <select name="mes" class="form-select">
      <option value="">Mês</option>
      {% for m in months %}
      <option value="{{ m }}" {% if filtro_mes_int == m %}selected{% endif %}>{{ m|stringformat:"02d" }}</option>
      {% endfor %}
    </select>
    <input type="number" name="ano" class="form-control" placeholder="Ano" value="{{ filtro_ano }}" min="1900" max="2100">
    <button class="btn btn-primary" type="submit">Filtrar</button>
    <a class="btn btn-outline-secondary" href="/relatorios/">Limpar</a>
  </form>
</div>
<div class="row g-3">
  <div class="col-12 col-md-4">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6">{{ total_associados }}</div>
        <div class="text-muted">Associados</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-4">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6 text-success">{{ total_mensalidades_pagas }}</div>
        <div class="text-muted">Mensalidades Pagas</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-4">
    <div class="card text-center">
      <div class="card-body">
        <div class="display-6 text-warning">{{ total_mensalidades_pendentes }}</div>
        <div class="text-muted">Mensalidades Pendentes</div>
      </div>
    </div>
  </div>
</div>
<div class="card mt-3">
  <div class="card-body">
    <h2 class="h6">Devedores (até 50)</h2>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead><tr><th>Nome</th><th>CPF</th><th>RGP</th><th></th></tr></thead>
        <tbody>
          {% for p in devedores %}
          <tr>
            <td>{{ p.nome }}</td>
            <td>{{ p.cpf }}</td>
            <td>{{ p.rgp }}</td>
            <td class="text-end"><a href="{% url 'associados:pescador_detail' p.pk %}" class="btn btn-sm btn-outline-primary">Abrir</a></td>
          </tr>
          {% empty %}
          <tr><td colspan="4" class="text-center text-muted">Sem devedores no momento.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
